<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="robots" content="noindex, nofollow">
    <title>上野東照宮 電子巡拝</title>
    <link href="https://fonts.googleapis.com/css2?family=Yuji+Syuku&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #c5a059;
            --dark-purple: #3e005d;
            --bg-gray: #f2f2f2;
            --bar-h: 70px;
        }
        body, html { margin: 0; padding: 0; height: 100%; font-family: serif; overflow: hidden; background: #111; }
        
        /* バーのデザイン */
        .bar {
            width: 100%; height: var(--bar-h);
            display: flex; align-items: center; justify-content: center;
            font-size: 1.6rem; font-family: 'Yuji Syuku', serif;
            cursor: pointer; position: absolute; z-index: 20;
            background: #888; color: #333; /* 未訪問時はグレー気味 */
            transition: all 0.7s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 -2px 10px rgba(0,0,0,0.5);
        }

        /* 訪問済みのバー（URLアクセス後） */
        .bar.visited {
            background: var(--dark-purple);
            color: #fff;
        }

        /* 未訪問のバーに対する制限（クリック不可の視覚効果） */
        .bar.locked {
            cursor: not-allowed;
            opacity: 0.8;
            background: #555;
            color: #888;
        }

        .reward-btn {
            position: absolute; right: 15px; top: 50%; transform: translateY(-50%);
            font-size: 0.7rem; background: rgba(255,255,255,0.15);
            color: #fff; border: 1px solid rgba(255,255,255,0.5);
            padding: 6px 10px; border-radius: 4px; display: none;
            font-family: sans-serif;
        }

        /* コンテンツ */
        .content {
            position: absolute; width: 100%; background: var(--bg-gray);
            padding: 40px 30px; box-sizing: border-box;
            opacity: 0; pointer-events: none; transition: opacity 0.6s ease;
            z-index: 10; overflow-y: auto;
        }
        .content.active { opacity: 1; pointer-events: auto; }

        .fude {
            font-family: 'Yuji Syuku', serif; font-size: 1.15rem;
            line-height: 2.3; color: #1a1a1a; text-align: justify; white-space: pre-wrap;
        }

        .section-title {
            display: block; font-size: 1.4rem; border-bottom: 1px solid var(--gold);
            margin-bottom: 20px; text-align: center; color: var(--dark-purple);
        }

        /* 電子御朱印表示 */
        .goshuin-box {
            width: 230px; height: 320px; margin: 20px auto;
            border: 2px solid var(--gold); background: #fff;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            box-shadow: 0 0 30px rgba(0,0,0,0.15);
            position: relative;
        }
        .goshuin-box::before {
            content: "電子御朱印証"; position: absolute; top: 10px; font-size: 0.8rem; color: var(--gold);
        }
        .btn {
            background: var(--dark-purple); color: #fff; padding: 12px 25px;
            text-decoration: none; border-radius: 30px; display: inline-block;
            margin-top: 20px; border: 1px solid var(--gold); font-size: 0.9rem;
        }

        /* 完了メッセージ */
        #msg-popup {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #fff; border: 4px double var(--gold); padding: 30px;
            z-index: 100; display: none; text-align: center; width: 85%;
            box-shadow: 0 0 100px rgba(0,0,0,0.8);
        }
    </style>
</head>
<body>

<div id="msg-popup">
    <div class="fude" style="font-size: 1.1rem; text-align: center;">
        巡拝、大慶に存じます。
        <br><br>
        三つの証が揃いました。
        社務所にてこの画面をご提示ください。
        徳川ゆかりの「奉納章」をお受けいただけます。
    </div>
    <button onclick="closePopup()" style="margin-top:20px; padding: 10px 25px; cursor: pointer;">閉じる</button>
</div>

<div id="c1" class="content">
    <span class="section-title">【由緒書き】</span>
    <div class="fude">上野東照宮は、寛永四年（一六二七年）、津藩主藤堂高虎公と天海大僧正により、徳川家康公（東照大権現）を祀る神社として創建されました。

現存する社殿は、三代将軍徳川家光公が慶安四年（一六五一年）に大規模に造替したもので、江戸の面影を今に伝える貴重な文化遺産として国の重要文化財に指定されています。

幕末の彰義隊による上野戦争や、関東大震災、そして第二次世界大戦の空襲にあっても奇跡的に倒壊を免れたことから、「強運」の神様としても厚い信仰を集めております。</div>
</div>
<div id="b1" class="bar" onclick="tryMove(1)">壱</span></div>

<div id="c2" class="content">
    <span class="section-title">【境内見所】</span>
    <div class="fude">当宮の象徴である「金色殿（御社殿）」は、その名の通り金箔を惜しみなく用いた豪華絢爛な建築で、江戸時代初期の技巧が凝縮されています。

参道に並ぶ二百基以上の「石灯籠」は、全国の大名が家康公への尊崇の念を込めて奉納したもので、その圧倒的な数は圧巻です。

また、彫刻家・左甚五郎の作と伝えられる「昇り龍・降り龍」の彫刻は、夜な夜な不忍池へ水を飲みに行くという伝説が残るほど生命感に溢れています。</div>
</div>
<div id="b2" class="bar" onclick="tryMove(2)">弐</span></div>

<div id="c3" class="content" style="text-align:center;">
    <span class="section-title">【参拝の証】</span>
    <div class="fude" style="text-align:center; margin-bottom: 20px;">三つ目の地を訪れた証として、<br>特別な電子御朱印を授与いたします。</div>
    <div class="goshuin-box">
        <span style="color:#d00; font-family:'Yuji Syuku'; font-size:2.5rem; opacity:0.7;">上野<br>東照宮</span>
        <div style="margin-top:30px; border-top:1px solid #eee; padding-top:10px; color:var(--gold); font-size:0.8rem;">
            令和七年 師走
        </div>
    </div>
    <a href="#" class="btn" onclick="alert('電子御朱印を保存しました');return false;">電子御朱印を保存</a>
</div>
<div id="b3" class="bar" onclick="tryMove(3)">参<span class="reward-btn" onclick="showReward(event)">巡拝の記念について</span></div>

<script>
    const bs = [document.getElementById('b1'), document.getElementById('b2'), document.getElementById('b3')];
    const cs = [document.getElementById('c1'), document.getElementById('c2'), document.getElementById('c3')];
    const bh = 70;

    let visited = JSON.parse(localStorage.getItem('toshogu_visited_v3') || '[false, false, false]');
    let hasShownPopup = localStorage.getItem('toshogu_popup_shown_v3') === 'true';

    function init() {
        const urlParams = new URLSearchParams(window.location.search);
        const page = parseInt(urlParams.get('page'));

        // URLにpageパラメータがある場合のみ、訪問済みに更新
        if (page >= 1 && page <= 3) {
            visited[page-1] = true;
            localStorage.setItem('toshogu_visited_v3', JSON.stringify(visited));
            move(page);
        } else {
            // パラメータがない場合、既に訪問済みのものがあればそれを開く、なければ1を開く（ただしロック解除はURLのみ）
            move(1); 
        }

        applyState();
        checkComplete();
    }

    // タップ時に動かそうとする関数
    function tryMove(n) {
        // もしそのバーが未訪問（visitedではない）なら開かない
        if (!visited[n-1]) {
            alert("この場所を訪れると、内容が閲覧可能になります。");
            return;
        }
        move(n);
    }

    function move(n) {
        const h = window.innerHeight;
        bs.forEach((b, i) => {
            let t;
            if (n===1) t = h - (bh*(3-i));
            else if (n===2) t = (i===0) ? 0 : h - (bh*(3-i));
            else t = (i<2) ? i*bh : h - bh;
            b.style.top = t + 'px';
        });
        cs.forEach((c, i) => {
            c.classList.remove('active');
            if (i+1===n) {
                c.classList.add('active');
                c.style.top = (n===1?0 : n===2?bh : bh*2)+'px';
                c.style.height = (h-(bh*3))+'px';
            }
        });
    }

    function applyState() {
        visited.forEach((v, i) => {
            if(v) {
                bs[i].classList.add('visited');
                bs[i].classList.remove('locked');
            } else {
                bs[i].classList.add('locked');
            }
        });
        
        if (visited.every(v => v === true)) {
            document.querySelectorAll('.reward-btn').forEach(btn => btn.style.display = 'block');
        }
    }

    function checkComplete() {
        if (visited.every(v => v === true) && !hasShownPopup) {
            setTimeout(() => {
                document.getElementById('msg-popup').style.display = 'block';
            }, 1000);
        }
    }

    function closePopup() {
        document.getElementById('msg-popup').style.display = 'none';
        localStorage.setItem('toshogu_popup_shown_v3', 'true');
        hasShownPopup = true;
    }

    function showReward(event) {
        event.stopPropagation();
        alert("【巡拝記念】\n社務所にてこの画面を提示してください。徳川家ゆかりの特別な記念褒章（奉納章）を¥1,000でお受けできます。");
    }

    window.onload = init;
</script>
</body>
</html>